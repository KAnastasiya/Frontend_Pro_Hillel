!function(t){function e(n){if(s[n])return s[n].exports;var i=s[n]={exports:{},id:n,loaded:!1};return t[n].call(i.exports,i,i.exports,e),i.loaded=!0,i.exports}var s={};return e.m=t,e.c=s,e.p="",e(0)}([function(t,e,s){t.exports=s(1)},function(t,e,s){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}var i=s(2),a=n(i);new a.default(document.querySelector(".todolist"))},function(t,e,s){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var s=0;s<e.length;s++){var n=e[s];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,s,n){return s&&t(e.prototype,s),n&&t(e,n),e}}(),a=s(3),o=function(){function t(e){n(this,t),this.todoList=e,this.taskId=1,this.onEnterKeyUp=this.onEnterKeyUp.bind(this),this.onNewTaskNameInput=this.onNewTaskNameInput.bind(this),this.onNewTaskBtnClick=this.onNewTaskBtnClick.bind(this),this.onCheckTaskClick=this.onCheckTaskClick.bind(this),this.onRemoveTaskClick=this.onRemoveTaskClick.bind(this),this.onCheckAllTaskClick=this.onCheckAllTaskClick.bind(this),this.onRemoveAllTaskClick=this.onRemoveAllTaskClick.bind(this),this.init()}return i(t,[{key:"init",value:function(){(0,a.createDOMElement)("h1",this.todoList,{className:"todolist__title",textContent:"TodoList"});var t=(0,a.createDOMElement)("div",this.todoList,{className:"todolist__add-task"});this.newTaskName=(0,a.createDOMElement)("input",t,{type:"text",className:"input input--text input--new-task",placeholder:"Enter task"}),this.newTaskName.addEventListener("input",this.onNewTaskNameInput),this.newTaskBtn=(0,a.createDOMElement)("button",t,{type:"button",className:"btn btn--primary btn--add",textContent:"Add",disabled:!0}),this.newTaskBtn.addEventListener("click",this.onNewTaskBtnClick),this.todoList.addEventListener("keyup",this.onEnterKeyUp)}},{key:"renderTasksContainer",value:function(){this.tasks=(0,a.createDOMElement)("ul",this.todoList,{className:"todolist__tasks tasks"}),this.tasks.addEventListener("click",this.onCheckTaskClick),this.tasks.addEventListener("click",this.onRemoveTaskClick)}},{key:"renderControls",value:function(){this.controls=(0,a.createDOMElement)("div",this.todoList,{className:"todolist__controls"});var t=(0,a.createDOMElement)("p",this.controls,{className:"todolist__tips"});this.currentCheckedTasks=(0,a.createDOMElement)("span",t,{className:"current-checked-tasks",textContent:"0"}),(0,a.createDOMElement)("span",t,{textContent:" items checked"}),this.checkAllTasksBtn=(0,a.createDOMElement)("button",this.controls,{type:"button",className:"btn btn--additional btn--check",textContent:"Check all"}),this.checkAllTasksBtn.addEventListener("click",this.onCheckAllTaskClick),this.clearTaskListBtn=(0,a.createDOMElement)("button",this.controls,{type:"button",className:"btn btn--additional btn--clear",textContent:"Remove all",disabled:!0}),this.clearTaskListBtn.addEventListener("click",this.onRemoveAllTaskClick)}},{key:"renderTask",value:function(t){this.tasks||this.renderTasksContainer();var e=(0,a.createDOMElement)("li",this.tasks,{className:"tasks__item"});(0,a.createDOMElement)("input",e,{type:"checkbox",className:"input input--checkbox",name:"taskList",id:"checkbox-"+this.taskId,value:"checkbox-"+this.taskId}),(0,a.createDOMElement)("label",e,{htmlFor:"checkbox-"+this.taskId,className:"label label--checkbox",textContent:t}),(0,a.createDOMElement)("div",e,{className:"icon icon--remove"}),this.taskId++}},{key:"addTaskToList",value:function(){this.renderTask(this.newTaskName.value),this.newTaskName.value="",this.newTaskBtn.disabled=!0,this.controls?this.updateControlsState():this.renderControls()}},{key:"removeTaskFromList",value:function(t){this.tasks.removeChild(t),this.tasks.firstChild||(this.todoList.removeChild(this.tasks),this.todoList.removeChild(this.controls),this.tasks=null,this.controls=null,this.checkAllTasksBtn=null,this.clearTaskListBtn=null,this.currentCheckedTasks=null)}},{key:"updateControlsState",value:function(){if(this.tasks){var t=this.checkedTasksCount;this.currentCheckedTasks.textContent=t,this.clearTaskListBtn.disabled=!(t>0),this.checkAllTasksBtn.textContent=t!==this.tasks.children.length?"Check all":"Uncheck all"}}},{key:"onNewTaskNameInput",value:function(t){this.newTaskBtn.disabled=!t.currentTarget.value}},{key:"onNewTaskBtnClick",value:function(){this.addTaskToList()}},{key:"onEnterKeyUp",value:function(t){13===t.keyCode&&this.newTaskName.value&&this.addTaskToList()}},{key:"onCheckTaskClick",value:function(t){t.target.classList.contains("input--checkbox")&&this.updateControlsState()}},{key:"onCheckAllTaskClick",value:function(){var t=(0,a.convertPreudoArrayToArray)(this.tasks.children),e=this.checkedTasksCount;t.forEach(function(s){return s.querySelector(".input--checkbox").checked=!(e===t.length)}),this.updateControlsState()}},{key:"onRemoveTaskClick",value:function(t){t.target.classList.contains("icon--remove")&&(this.removeTaskFromList(t.target.parentElement),this.updateControlsState())}},{key:"onRemoveAllTaskClick",value:function(){for(var t=this.tasks.children,e=t.length-1;e>=0;e--)t[e].querySelector(".input--checkbox:checked")&&this.removeTaskFromList(t[e]);this.updateControlsState()}},{key:"checkedTasksCount",get:function(){return(0,a.convertPreudoArrayToArray)(this.tasks.children).filter(function(t){return t.querySelector(".input--checkbox:checked")}).length}}]),t}();e.default=o},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.createDOMElement=function(t,e,s){var n=document.createElement(t);for(var i in s)s.hasOwnProperty(i)&&(n[i]=s[i]);return e.appendChild(n),n},e.convertPreudoArrayToArray=function(t){return Array.from(t)}}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vc2NyaXB0LmpzIiwid2VicGFjazovLy93ZWJwYWNrL2Jvb3RzdHJhcCAzOTE2NmJmZjg1OGMxY2QzNjRkNyIsIndlYnBhY2s6Ly8vLi9zcmMvc2NyaXB0LmpzIiwid2VicGFjazovLy8uL3NyYy9qcy9Ub2RvbGlzdC5qcyIsIndlYnBhY2s6Ly8vLi9zcmMvanMvdXRpbHMuanMiXSwibmFtZXMiOlsibW9kdWxlcyIsIl9fd2VicGFja19yZXF1aXJlX18iLCJtb2R1bGVJZCIsImluc3RhbGxlZE1vZHVsZXMiLCJleHBvcnRzIiwibW9kdWxlIiwiaWQiLCJsb2FkZWQiLCJjYWxsIiwibSIsImMiLCJwIiwiX2ludGVyb3BSZXF1aXJlRGVmYXVsdCIsIm9iaiIsIl9fZXNNb2R1bGUiLCJkZWZhdWx0IiwiX1RvZG9saXN0IiwiX1RvZG9saXN0MiIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvciIsIl9jbGFzc0NhbGxDaGVjayIsImluc3RhbmNlIiwiQ29uc3RydWN0b3IiLCJUeXBlRXJyb3IiLCJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsInZhbHVlIiwiX2NyZWF0ZUNsYXNzIiwiZGVmaW5lUHJvcGVydGllcyIsInRhcmdldCIsInByb3BzIiwiaSIsImxlbmd0aCIsImRlc2NyaXB0b3IiLCJlbnVtZXJhYmxlIiwiY29uZmlndXJhYmxlIiwid3JpdGFibGUiLCJrZXkiLCJwcm90b1Byb3BzIiwic3RhdGljUHJvcHMiLCJwcm90b3R5cGUiLCJfdXRpbHMiLCJUb2RvbGlzdCIsImVsZW0iLCJ0aGlzIiwidG9kb0xpc3QiLCJ0YXNrSWQiLCJvbkVudGVyS2V5VXAiLCJiaW5kIiwib25OZXdUYXNrTmFtZUlucHV0Iiwib25OZXdUYXNrQnRuQ2xpY2siLCJvbkNoZWNrVGFza0NsaWNrIiwib25SZW1vdmVUYXNrQ2xpY2siLCJvbkNoZWNrQWxsVGFza0NsaWNrIiwib25SZW1vdmVBbGxUYXNrQ2xpY2siLCJpbml0IiwiY3JlYXRlRE9NRWxlbWVudCIsImNsYXNzTmFtZSIsInRleHRDb250ZW50IiwibmV3VGFzayIsIm5ld1Rhc2tOYW1lIiwidHlwZSIsInBsYWNlaG9sZGVyIiwiYWRkRXZlbnRMaXN0ZW5lciIsIm5ld1Rhc2tCdG4iLCJkaXNhYmxlZCIsInRhc2tzIiwiY29udHJvbHMiLCJ0aXBzIiwiY3VycmVudENoZWNrZWRUYXNrcyIsImNoZWNrQWxsVGFza3NCdG4iLCJjbGVhclRhc2tMaXN0QnRuIiwidGV4dCIsInJlbmRlclRhc2tzQ29udGFpbmVyIiwidGFzayIsIm5hbWUiLCJodG1sRm9yIiwicmVuZGVyVGFzayIsInVwZGF0ZUNvbnRyb2xzU3RhdGUiLCJyZW5kZXJDb250cm9scyIsInJlbW92ZUNoaWxkIiwiZmlyc3RDaGlsZCIsImN1cnJlbnRDaGVja2VkVGFza3NDb3VudCIsImNoZWNrZWRUYXNrc0NvdW50IiwiY2hpbGRyZW4iLCJldmVudCIsImN1cnJlbnRUYXJnZXQiLCJhZGRUYXNrVG9MaXN0Iiwia2V5Q29kZSIsImNsYXNzTGlzdCIsImNvbnRhaW5zIiwiY29udmVydFByZXVkb0FycmF5VG9BcnJheSIsImN1cnJlbnRDaGVja2VkQ291bnQiLCJmb3JFYWNoIiwiaXRlbSIsImNoZWNrZWQiLCJyZW1vdmVUYXNrRnJvbUxpc3QiLCJwYXJlbnRFbGVtZW50IiwiZ2V0IiwiZmlsdGVyIiwicGFyZW50Iiwib3B0aW9ucyIsImNyZWF0ZUVsZW1lbnQiLCJwcm9wIiwiaGFzT3duUHJvcGVydHkiLCJhcHBlbmRDaGlsZCIsImxpc3QiLCJBcnJheSIsImZyb20iXSwibWFwcGluZ3MiOiJDQUFTLFNBQVVBLEdDSW5CLFFBQUFDLEdBQUFDLEdBR0EsR0FBQUMsRUFBQUQsR0FDQSxNQUFBQyxHQUFBRCxHQUFBRSxPQUdBLElBQUFDLEdBQUFGLEVBQUFELElBQ0FFLFdBQ0FFLEdBQUFKLEVBQ0FLLFFBQUEsRUFVQSxPQU5BUCxHQUFBRSxHQUFBTSxLQUFBSCxFQUFBRCxRQUFBQyxJQUFBRCxRQUFBSCxHQUdBSSxFQUFBRSxRQUFBLEVBR0FGLEVB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WkEsR0FRSWdELDRCQUE0QixTQUFBZSxHQUFBLE1BQVFDLE9BQU1DLEtBQUtGIiwiZmlsZSI6InNjcmlwdC5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKioqKiovIChmdW5jdGlvbihtb2R1bGVzKSB7IC8vIHdlYnBhY2tCb290c3RyYXBcbi8qKioqKiovIFx0Ly8gVGhlIG1vZHVsZSBjYWNoZVxuLyoqKioqKi8gXHR2YXIgaW5zdGFsbGVkTW9kdWxlcyA9IHt9O1xuLyoqKioqKi9cbi8qKioqKiovIFx0Ly8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbi8qKioqKiovIFx0ZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkge1xuLyoqKioqKi9cbi8qKioqKiovIFx0XHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcbi8qKioqKiovIFx0XHRpZihpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSlcbi8qKioqKiovIFx0XHRcdHJldHVybiBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXS5leHBvcnRzO1xuLyoqKioqKi9cbi8qKioqKiovIFx0XHQvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKVxuLyoqKioqKi8gXHRcdHZhciBtb2R1bGUgPSBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSA9IHtcbi8qKioqKiovIFx0XHRcdGV4cG9ydHM6IHt9LFxuLyoqKioqKi8gXHRcdFx0aWQ6IG1vZHVsZUlkLFxuLyoqKioqKi8gXHRcdFx0bG9hZGVkOiBmYWxzZVxuLyoqKioqKi8gXHRcdH07XG4vKioqKioqL1xuLyoqKioqKi8gXHRcdC8vIEV4ZWN1dGUgdGhlIG1vZHVsZSBmdW5jdGlvblxuLyoqKioqKi8gXHRcdG1vZHVsZXNbbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuLyoqKioqKi9cbi8qKioqKiovIFx0XHQvLyBGbGFnIHRoZSBtb2R1bGUgYXMgbG9hZGVkXG4vKioqKioqLyBcdFx0bW9kdWxlLmxvYWRlZCA9IHRydWU7XG4vKioqKioqL1xuLyoqKioqKi8gXHRcdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG4vKioqKioqLyBcdFx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xuLyoqKioqKi8gXHR9XG4vKioqKioqL1xuLyoqKioqKi9cbi8qKioqKiovIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGVzIG9iamVjdCAoX193ZWJwYWNrX21vZHVsZXNfXylcbi8qKioqKiovIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5tID0gbW9kdWxlcztcbi8qKioqKiovXG4vKioqKioqLyBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlIGNhY2hlXG4vKioqKioqLyBcdF9fd2VicGFja19yZXF1aXJlX18uYyA9IGluc3RhbGxlZE1vZHVsZXM7XG4vKioqKioqL1xuLyoqKioqKi8gXHQvLyBfX3dlYnBhY2tfcHVibGljX3BhdGhfX1xuLyoqKioqKi8gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnAgPSBcIlwiO1xuLyoqKioqKi9cbi8qKioqKiovIFx0Ly8gTG9hZCBlbnRyeSBtb2R1bGUgYW5kIHJldHVybiBleHBvcnRzXG4vKioqKioqLyBcdHJldHVybiBfX3dlYnBhY2tfcmVxdWlyZV9fKDApO1xuLyoqKioqKi8gfSlcbi8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovXG4vKioqKioqLyAoW1xuLyogMCAqL1xuLyoqKi8gZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7XG5cblx0bW9kdWxlLmV4cG9ydHMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEpO1xuXG5cbi8qKiovIH0sXG4vKiAxICovXG4vKioqLyBmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHtcblxuXHQndXNlIHN0cmljdCc7XG5cdFxuXHR2YXIgX1RvZG9saXN0ID0gX193ZWJwYWNrX3JlcXVpcmVfXygyKTtcblx0XG5cdHZhciBfVG9kb2xpc3QyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfVG9kb2xpc3QpO1xuXHRcblx0ZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsgZGVmYXVsdDogb2JqIH07IH1cblx0XG5cdHZhciB0b2RvTGlzdCA9IG5ldyBfVG9kb2xpc3QyLmRlZmF1bHQoZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnRvZG9saXN0JykpO1xuXG4vKioqLyB9LFxuLyogMiAqL1xuLyoqKi8gZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7XG5cblx0J3VzZSBzdHJpY3QnO1xuXHRcblx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7XG5cdCAgdmFsdWU6IHRydWVcblx0fSk7XG5cdFxuXHR2YXIgX2NyZWF0ZUNsYXNzID0gZnVuY3Rpb24gKCkgeyBmdW5jdGlvbiBkZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHsgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykgeyB2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldOyBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7IGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTsgaWYgKFwidmFsdWVcIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOyB9IH0gcmV0dXJuIGZ1bmN0aW9uIChDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsgaWYgKHByb3RvUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsgaWYgKHN0YXRpY1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7IHJldHVybiBDb25zdHJ1Y3RvcjsgfTsgfSgpO1xuXHRcblx0dmFyIF91dGlscyA9IF9fd2VicGFja19yZXF1aXJlX18oMyk7XG5cdFxuXHRmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7IGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoXCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb25cIik7IH0gfVxuXHRcblx0dmFyIFRvZG9saXN0ID0gZnVuY3Rpb24gKCkge1xuXHQgIGZ1bmN0aW9uIFRvZG9saXN0KGVsZW0pIHtcblx0ICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBUb2RvbGlzdCk7XG5cdFxuXHQgICAgdGhpcy50b2RvTGlzdCA9IGVsZW07XG5cdCAgICB0aGlzLnRhc2tJZCA9IDE7XG5cdFxuXHQgICAgdGhpcy5vbkVudGVyS2V5VXAgPSB0aGlzLm9uRW50ZXJLZXlVcC5iaW5kKHRoaXMpO1xuXHQgICAgdGhpcy5vbk5ld1Rhc2tOYW1lSW5wdXQgPSB0aGlzLm9uTmV3VGFza05hbWVJbnB1dC5iaW5kKHRoaXMpO1xuXHQgICAgdGhpcy5vbk5ld1Rhc2tCdG5DbGljayA9IHRoaXMub25OZXdUYXNrQnRuQ2xpY2suYmluZCh0aGlzKTtcblx0ICAgIHRoaXMub25DaGVja1Rhc2tDbGljayA9IHRoaXMub25DaGVja1Rhc2tDbGljay5iaW5kKHRoaXMpO1xuXHQgICAgdGhpcy5vblJlbW92ZVRhc2tDbGljayA9IHRoaXMub25SZW1vdmVUYXNrQ2xpY2suYmluZCh0aGlzKTtcblx0ICAgIHRoaXMub25DaGVja0FsbFRhc2tDbGljayA9IHRoaXMub25DaGVja0FsbFRhc2tDbGljay5iaW5kKHRoaXMpO1xuXHQgICAgdGhpcy5vblJlbW92ZUFsbFRhc2tDbGljayA9IHRoaXMub25SZW1vdmVBbGxUYXNrQ2xpY2suYmluZCh0aGlzKTtcblx0XG5cdCAgICB0aGlzLmluaXQoKTtcblx0ICB9XG5cdFxuXHQgIF9jcmVhdGVDbGFzcyhUb2RvbGlzdCwgW3tcblx0ICAgIGtleTogJ2luaXQnLFxuXHQgICAgdmFsdWU6IGZ1bmN0aW9uIGluaXQoKSB7XG5cdCAgICAgICgwLCBfdXRpbHMuY3JlYXRlRE9NRWxlbWVudCkoJ2gxJywgdGhpcy50b2RvTGlzdCwge1xuXHQgICAgICAgIGNsYXNzTmFtZTogJ3RvZG9saXN0X190aXRsZScsXG5cdCAgICAgICAgdGV4dENvbnRlbnQ6ICdUb2RvTGlzdCdcblx0ICAgICAgfSk7XG5cdFxuXHQgICAgICB2YXIgbmV3VGFzayA9ICgwLCBfdXRpbHMuY3JlYXRlRE9NRWxlbWVudCkoJ2RpdicsIHRoaXMudG9kb0xpc3QsIHtcblx0ICAgICAgICBjbGFzc05hbWU6ICd0b2RvbGlzdF9fYWRkLXRhc2snXG5cdCAgICAgIH0pO1xuXHRcblx0ICAgICAgdGhpcy5uZXdUYXNrTmFtZSA9ICgwLCBfdXRpbHMuY3JlYXRlRE9NRWxlbWVudCkoJ2lucHV0JywgbmV3VGFzaywge1xuXHQgICAgICAgIHR5cGU6ICd0ZXh0Jyxcblx0ICAgICAgICBjbGFzc05hbWU6ICdpbnB1dCBpbnB1dC0tdGV4dCBpbnB1dC0tbmV3LXRhc2snLFxuXHQgICAgICAgIHBsYWNlaG9sZGVyOiAnRW50ZXIgdGFzaydcblx0ICAgICAgfSk7XG5cdCAgICAgIHRoaXMubmV3VGFza05hbWUuYWRkRXZlbnRMaXN0ZW5lcignaW5wdXQnLCB0aGlzLm9uTmV3VGFza05hbWVJbnB1dCk7XG5cdFxuXHQgICAgICB0aGlzLm5ld1Rhc2tCdG4gPSAoMCwgX3V0aWxzLmNyZWF0ZURPTUVsZW1lbnQpKCdidXR0b24nLCBuZXdUYXNrLCB7XG5cdCAgICAgICAgdHlwZTogJ2J1dHRvbicsXG5cdCAgICAgICAgY2xhc3NOYW1lOiAnYnRuIGJ0bi0tcHJpbWFyeSBidG4tLWFkZCcsXG5cdCAgICAgICAgdGV4dENvbnRlbnQ6ICdBZGQnLFxuXHQgICAgICAgIGRpc2FibGVkOiB0cnVlXG5cdCAgICAgIH0pO1xuXHQgICAgICB0aGlzLm5ld1Rhc2tCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLm9uTmV3VGFza0J0bkNsaWNrKTtcblx0XG5cdCAgICAgIHRoaXMudG9kb0xpc3QuYWRkRXZlbnRMaXN0ZW5lcigna2V5dXAnLCB0aGlzLm9uRW50ZXJLZXlVcCk7XG5cdCAgICB9XG5cdCAgfSwge1xuXHQgICAga2V5OiAncmVuZGVyVGFza3NDb250YWluZXInLFxuXHQgICAgdmFsdWU6IGZ1bmN0aW9uIHJlbmRlclRhc2tzQ29udGFpbmVyKCkge1xuXHQgICAgICB0aGlzLnRhc2tzID0gKDAsIF91dGlscy5jcmVhdGVET01FbGVtZW50KSgndWwnLCB0aGlzLnRvZG9MaXN0LCB7XG5cdCAgICAgICAgY2xhc3NOYW1lOiAndG9kb2xpc3RfX3Rhc2tzIHRhc2tzJ1xuXHQgICAgICB9KTtcblx0ICAgICAgdGhpcy50YXNrcy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMub25DaGVja1Rhc2tDbGljayk7XG5cdCAgICAgIHRoaXMudGFza3MuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLm9uUmVtb3ZlVGFza0NsaWNrKTtcblx0ICAgIH1cblx0ICB9LCB7XG5cdCAgICBrZXk6ICdyZW5kZXJDb250cm9scycsXG5cdCAgICB2YWx1ZTogZnVuY3Rpb24gcmVuZGVyQ29udHJvbHMoKSB7XG5cdCAgICAgIHRoaXMuY29udHJvbHMgPSAoMCwgX3V0aWxzLmNyZWF0ZURPTUVsZW1lbnQpKCdkaXYnLCB0aGlzLnRvZG9MaXN0LCB7XG5cdCAgICAgICAgY2xhc3NOYW1lOiAndG9kb2xpc3RfX2NvbnRyb2xzJ1xuXHQgICAgICB9KTtcblx0XG5cdCAgICAgIHZhciB0aXBzID0gKDAsIF91dGlscy5jcmVhdGVET01FbGVtZW50KSgncCcsIHRoaXMuY29udHJvbHMsIHtcblx0ICAgICAgICBjbGFzc05hbWU6ICd0b2RvbGlzdF9fdGlwcydcblx0ICAgICAgfSk7XG5cdFxuXHQgICAgICB0aGlzLmN1cnJlbnRDaGVja2VkVGFza3MgPSAoMCwgX3V0aWxzLmNyZWF0ZURPTUVsZW1lbnQpKCdzcGFuJywgdGlwcywge1xuXHQgICAgICAgIGNsYXNzTmFtZTogJ2N1cnJlbnQtY2hlY2tlZC10YXNrcycsXG5cdCAgICAgICAgdGV4dENvbnRlbnQ6ICcwJ1xuXHQgICAgICB9KTtcblx0XG5cdCAgICAgICgwLCBfdXRpbHMuY3JlYXRlRE9NRWxlbWVudCkoJ3NwYW4nLCB0aXBzLCB7XG5cdCAgICAgICAgdGV4dENvbnRlbnQ6ICcgaXRlbXMgY2hlY2tlZCdcblx0ICAgICAgfSk7XG5cdFxuXHQgICAgICB0aGlzLmNoZWNrQWxsVGFza3NCdG4gPSAoMCwgX3V0aWxzLmNyZWF0ZURPTUVsZW1lbnQpKCdidXR0b24nLCB0aGlzLmNvbnRyb2xzLCB7XG5cdCAgICAgICAgdHlwZTogJ2J1dHRvbicsXG5cdCAgICAgICAgY2xhc3NOYW1lOiAnYnRuIGJ0bi0tYWRkaXRpb25hbCBidG4tLWNoZWNrJyxcblx0ICAgICAgICB0ZXh0Q29udGVudDogJ0NoZWNrIGFsbCdcblx0ICAgICAgfSk7XG5cdCAgICAgIHRoaXMuY2hlY2tBbGxUYXNrc0J0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMub25DaGVja0FsbFRhc2tDbGljayk7XG5cdFxuXHQgICAgICB0aGlzLmNsZWFyVGFza0xpc3RCdG4gPSAoMCwgX3V0aWxzLmNyZWF0ZURPTUVsZW1lbnQpKCdidXR0b24nLCB0aGlzLmNvbnRyb2xzLCB7XG5cdCAgICAgICAgdHlwZTogJ2J1dHRvbicsXG5cdCAgICAgICAgY2xhc3NOYW1lOiAnYnRuIGJ0bi0tYWRkaXRpb25hbCBidG4tLWNsZWFyJyxcblx0ICAgICAgICB0ZXh0Q29udGVudDogJ1JlbW92ZSBhbGwnLFxuXHQgICAgICAgIGRpc2FibGVkOiB0cnVlXG5cdCAgICAgIH0pO1xuXHQgICAgICB0aGlzLmNsZWFyVGFza0xpc3RCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLm9uUmVtb3ZlQWxsVGFza0NsaWNrKTtcblx0ICAgIH1cblx0ICB9LCB7XG5cdCAgICBrZXk6ICdyZW5kZXJUYXNrJyxcblx0ICAgIHZhbHVlOiBmdW5jdGlvbiByZW5kZXJUYXNrKHRleHQpIHtcblx0ICAgICAgaWYgKCF0aGlzLnRhc2tzKSB7XG5cdCAgICAgICAgdGhpcy5yZW5kZXJUYXNrc0NvbnRhaW5lcigpO1xuXHQgICAgICB9XG5cdFxuXHQgICAgICB2YXIgdGFzayA9ICgwLCBfdXRpbHMuY3JlYXRlRE9NRWxlbWVudCkoJ2xpJywgdGhpcy50YXNrcywge1xuXHQgICAgICAgIGNsYXNzTmFtZTogJ3Rhc2tzX19pdGVtJ1xuXHQgICAgICB9KTtcblx0XG5cdCAgICAgICgwLCBfdXRpbHMuY3JlYXRlRE9NRWxlbWVudCkoJ2lucHV0JywgdGFzaywge1xuXHQgICAgICAgIHR5cGU6ICdjaGVja2JveCcsXG5cdCAgICAgICAgY2xhc3NOYW1lOiAnaW5wdXQgaW5wdXQtLWNoZWNrYm94Jyxcblx0ICAgICAgICBuYW1lOiAndGFza0xpc3QnLFxuXHQgICAgICAgIGlkOiAnY2hlY2tib3gtJyArIHRoaXMudGFza0lkLFxuXHQgICAgICAgIHZhbHVlOiAnY2hlY2tib3gtJyArIHRoaXMudGFza0lkXG5cdCAgICAgIH0pO1xuXHRcblx0ICAgICAgKDAsIF91dGlscy5jcmVhdGVET01FbGVtZW50KSgnbGFiZWwnLCB0YXNrLCB7XG5cdCAgICAgICAgaHRtbEZvcjogJ2NoZWNrYm94LScgKyB0aGlzLnRhc2tJZCxcblx0ICAgICAgICBjbGFzc05hbWU6ICdsYWJlbCBsYWJlbC0tY2hlY2tib3gnLFxuXHQgICAgICAgIHRleHRDb250ZW50OiB0ZXh0XG5cdCAgICAgIH0pO1xuXHRcblx0ICAgICAgKDAsIF91dGlscy5jcmVhdGVET01FbGVtZW50KSgnZGl2JywgdGFzaywge1xuXHQgICAgICAgIGNsYXNzTmFtZTogJ2ljb24gaWNvbi0tcmVtb3ZlJ1xuXHQgICAgICB9KTtcblx0XG5cdCAgICAgIHRoaXMudGFza0lkKys7XG5cdCAgICB9XG5cdCAgfSwge1xuXHQgICAga2V5OiAnYWRkVGFza1RvTGlzdCcsXG5cdCAgICB2YWx1ZTogZnVuY3Rpb24gYWRkVGFza1RvTGlzdCgpIHtcblx0ICAgICAgdGhpcy5yZW5kZXJUYXNrKHRoaXMubmV3VGFza05hbWUudmFsdWUpO1xuXHQgICAgICB0aGlzLm5ld1Rhc2tOYW1lLnZhbHVlID0gJyc7XG5cdCAgICAgIHRoaXMubmV3VGFza0J0bi5kaXNhYmxlZCA9IHRydWU7XG5cdFxuXHQgICAgICBpZiAoIXRoaXMuY29udHJvbHMpIHtcblx0ICAgICAgICB0aGlzLnJlbmRlckNvbnRyb2xzKCk7XG5cdCAgICAgIH0gZWxzZSB7XG5cdCAgICAgICAgdGhpcy51cGRhdGVDb250cm9sc1N0YXRlKCk7XG5cdCAgICAgIH1cblx0ICAgIH1cblx0ICB9LCB7XG5cdCAgICBrZXk6ICdyZW1vdmVUYXNrRnJvbUxpc3QnLFxuXHQgICAgdmFsdWU6IGZ1bmN0aW9uIHJlbW92ZVRhc2tGcm9tTGlzdChlbGVtKSB7XG5cdCAgICAgIHRoaXMudGFza3MucmVtb3ZlQ2hpbGQoZWxlbSk7XG5cdCAgICAgIGlmICghdGhpcy50YXNrcy5maXJzdENoaWxkKSB7XG5cdCAgICAgICAgdGhpcy50b2RvTGlzdC5yZW1vdmVDaGlsZCh0aGlzLnRhc2tzKTtcblx0ICAgICAgICB0aGlzLnRvZG9MaXN0LnJlbW92ZUNoaWxkKHRoaXMuY29udHJvbHMpO1xuXHQgICAgICAgIHRoaXMudGFza3MgPSBudWxsO1xuXHQgICAgICAgIHRoaXMuY29udHJvbHMgPSBudWxsO1xuXHQgICAgICAgIHRoaXMuY2hlY2tBbGxUYXNrc0J0biA9IG51bGw7XG5cdCAgICAgICAgdGhpcy5jbGVhclRhc2tMaXN0QnRuID0gbnVsbDtcblx0ICAgICAgICB0aGlzLmN1cnJlbnRDaGVja2VkVGFza3MgPSBudWxsO1xuXHQgICAgICB9XG5cdCAgICB9XG5cdCAgfSwge1xuXHQgICAga2V5OiAndXBkYXRlQ29udHJvbHNTdGF0ZScsXG5cdCAgICB2YWx1ZTogZnVuY3Rpb24gdXBkYXRlQ29udHJvbHNTdGF0ZSgpIHtcblx0ICAgICAgaWYgKHRoaXMudGFza3MpIHtcblx0ICAgICAgICB2YXIgY3VycmVudENoZWNrZWRUYXNrc0NvdW50ID0gdGhpcy5jaGVja2VkVGFza3NDb3VudDtcblx0ICAgICAgICB0aGlzLmN1cnJlbnRDaGVja2VkVGFza3MudGV4dENvbnRlbnQgPSBjdXJyZW50Q2hlY2tlZFRhc2tzQ291bnQ7XG5cdCAgICAgICAgdGhpcy5jbGVhclRhc2tMaXN0QnRuLmRpc2FibGVkID0gIShjdXJyZW50Q2hlY2tlZFRhc2tzQ291bnQgPiAwKTtcblx0ICAgICAgICB0aGlzLmNoZWNrQWxsVGFza3NCdG4udGV4dENvbnRlbnQgPSAhKGN1cnJlbnRDaGVja2VkVGFza3NDb3VudCA9PT0gdGhpcy50YXNrcy5jaGlsZHJlbi5sZW5ndGgpID8gJ0NoZWNrIGFsbCcgOiAnVW5jaGVjayBhbGwnO1xuXHQgICAgICB9XG5cdCAgICB9XG5cdCAgfSwge1xuXHQgICAga2V5OiAnb25OZXdUYXNrTmFtZUlucHV0Jyxcblx0ICAgIHZhbHVlOiBmdW5jdGlvbiBvbk5ld1Rhc2tOYW1lSW5wdXQoZXZlbnQpIHtcblx0ICAgICAgdGhpcy5uZXdUYXNrQnRuLmRpc2FibGVkID0gIWV2ZW50LmN1cnJlbnRUYXJnZXQudmFsdWU7XG5cdCAgICB9XG5cdCAgfSwge1xuXHQgICAga2V5OiAnb25OZXdUYXNrQnRuQ2xpY2snLFxuXHQgICAgdmFsdWU6IGZ1bmN0aW9uIG9uTmV3VGFza0J0bkNsaWNrKCkge1xuXHQgICAgICB0aGlzLmFkZFRhc2tUb0xpc3QoKTtcblx0ICAgIH1cblx0ICB9LCB7XG5cdCAgICBrZXk6ICdvbkVudGVyS2V5VXAnLFxuXHQgICAgdmFsdWU6IGZ1bmN0aW9uIG9uRW50ZXJLZXlVcChldmVudCkge1xuXHQgICAgICBpZiAoZXZlbnQua2V5Q29kZSA9PT0gMTMgJiYgdGhpcy5uZXdUYXNrTmFtZS52YWx1ZSkge1xuXHQgICAgICAgIHRoaXMuYWRkVGFza1RvTGlzdCgpO1xuXHQgICAgICB9XG5cdCAgICB9XG5cdCAgfSwge1xuXHQgICAga2V5OiAnb25DaGVja1Rhc2tDbGljaycsXG5cdCAgICB2YWx1ZTogZnVuY3Rpb24gb25DaGVja1Rhc2tDbGljayhldmVudCkge1xuXHQgICAgICBpZiAoZXZlbnQudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnaW5wdXQtLWNoZWNrYm94JykpIHtcblx0ICAgICAgICB0aGlzLnVwZGF0ZUNvbnRyb2xzU3RhdGUoKTtcblx0ICAgICAgfVxuXHQgICAgfVxuXHQgIH0sIHtcblx0ICAgIGtleTogJ29uQ2hlY2tBbGxUYXNrQ2xpY2snLFxuXHQgICAgdmFsdWU6IGZ1bmN0aW9uIG9uQ2hlY2tBbGxUYXNrQ2xpY2soKSB7XG5cdCAgICAgIHZhciB0YXNrcyA9ICgwLCBfdXRpbHMuY29udmVydFByZXVkb0FycmF5VG9BcnJheSkodGhpcy50YXNrcy5jaGlsZHJlbik7XG5cdCAgICAgIHZhciBjdXJyZW50Q2hlY2tlZENvdW50ID0gdGhpcy5jaGVja2VkVGFza3NDb3VudDtcblx0ICAgICAgdGFza3MuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkge1xuXHQgICAgICAgIHJldHVybiBpdGVtLnF1ZXJ5U2VsZWN0b3IoJy5pbnB1dC0tY2hlY2tib3gnKS5jaGVja2VkID0gIShjdXJyZW50Q2hlY2tlZENvdW50ID09PSB0YXNrcy5sZW5ndGgpO1xuXHQgICAgICB9KTtcblx0ICAgICAgdGhpcy51cGRhdGVDb250cm9sc1N0YXRlKCk7XG5cdCAgICB9XG5cdCAgfSwge1xuXHQgICAga2V5OiAnb25SZW1vdmVUYXNrQ2xpY2snLFxuXHQgICAgdmFsdWU6IGZ1bmN0aW9uIG9uUmVtb3ZlVGFza0NsaWNrKGV2ZW50KSB7XG5cdCAgICAgIGlmIChldmVudC50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdpY29uLS1yZW1vdmUnKSkge1xuXHQgICAgICAgIHRoaXMucmVtb3ZlVGFza0Zyb21MaXN0KGV2ZW50LnRhcmdldC5wYXJlbnRFbGVtZW50KTtcblx0ICAgICAgICB0aGlzLnVwZGF0ZUNvbnRyb2xzU3RhdGUoKTtcblx0ICAgICAgfVxuXHQgICAgfVxuXHQgIH0sIHtcblx0ICAgIGtleTogJ29uUmVtb3ZlQWxsVGFza0NsaWNrJyxcblx0ICAgIHZhbHVlOiBmdW5jdGlvbiBvblJlbW92ZUFsbFRhc2tDbGljaygpIHtcblx0ICAgICAgdmFyIHRhc2tzID0gdGhpcy50YXNrcy5jaGlsZHJlbjtcblx0ICAgICAgZm9yICh2YXIgaSA9IHRhc2tzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7XG5cdCAgICAgICAgaWYgKHRhc2tzW2ldLnF1ZXJ5U2VsZWN0b3IoJy5pbnB1dC0tY2hlY2tib3g6Y2hlY2tlZCcpKSB7XG5cdCAgICAgICAgICB0aGlzLnJlbW92ZVRhc2tGcm9tTGlzdCh0YXNrc1tpXSk7XG5cdCAgICAgICAgfVxuXHQgICAgICB9XG5cdCAgICAgIHRoaXMudXBkYXRlQ29udHJvbHNTdGF0ZSgpO1xuXHQgICAgfVxuXHQgIH0sIHtcblx0ICAgIGtleTogJ2NoZWNrZWRUYXNrc0NvdW50Jyxcblx0ICAgIGdldDogZnVuY3Rpb24gZ2V0KCkge1xuXHQgICAgICB2YXIgdGFza3MgPSAoMCwgX3V0aWxzLmNvbnZlcnRQcmV1ZG9BcnJheVRvQXJyYXkpKHRoaXMudGFza3MuY2hpbGRyZW4pO1xuXHQgICAgICByZXR1cm4gdGFza3MuZmlsdGVyKGZ1bmN0aW9uIChpdGVtKSB7XG5cdCAgICAgICAgcmV0dXJuIGl0ZW0ucXVlcnlTZWxlY3RvcignLmlucHV0LS1jaGVja2JveDpjaGVja2VkJyk7XG5cdCAgICAgIH0pLmxlbmd0aDtcblx0ICAgIH1cblx0ICB9XSk7XG5cdFxuXHQgIHJldHVybiBUb2RvbGlzdDtcblx0fSgpO1xuXHRcblx0ZXhwb3J0cy5kZWZhdWx0ID0gVG9kb2xpc3Q7XG5cbi8qKiovIH0sXG4vKiAzICovXG4vKioqLyBmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMpIHtcblxuXHRcInVzZSBzdHJpY3RcIjtcblx0XG5cdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwge1xuXHQgIHZhbHVlOiB0cnVlXG5cdH0pO1xuXHQvKipcblx0ICogQ3JlYXRlIERPTS1lbGVtZW50XG5cdCAqIEBwYXJhbSAge1N0cmluZ30gIHR5cGUgICAgVHlwZSBvZiBlbGVtZW50XG5cdCAqIEBwYXJhbSAge0VsZW1lbnR9IHBhcmVudCAgUGFyZW50IG9mIGVsZW1lbnRcblx0ICogQHBhcmFtICB7T2JqZWN0fSAgb3B0aW9ucyBPcHRpb25zIG9mIGVsZW1lbnRcblx0ICogQHJldHVybiB7RWxlbWVudH1cblx0ICovXG5cdHZhciBjcmVhdGVET01FbGVtZW50ID0gZXhwb3J0cy5jcmVhdGVET01FbGVtZW50ID0gZnVuY3Rpb24gY3JlYXRlRE9NRWxlbWVudCh0eXBlLCBwYXJlbnQsIG9wdGlvbnMpIHtcblx0ICB2YXIgZWxlbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQodHlwZSk7XG5cdCAgZm9yICh2YXIgcHJvcCBpbiBvcHRpb25zKSB7XG5cdCAgICBpZiAob3B0aW9ucy5oYXNPd25Qcm9wZXJ0eShwcm9wKSkge1xuXHQgICAgICBlbGVtW3Byb3BdID0gb3B0aW9uc1twcm9wXTtcblx0ICAgIH1cblx0ICB9XG5cdCAgcGFyZW50LmFwcGVuZENoaWxkKGVsZW0pO1xuXHQgIHJldHVybiBlbGVtO1xuXHR9O1xuXHRcblx0LyoqXG5cdCAqIENvbnZlcnQgcHNldWRvLWFycmF5IHRvIGFycmF5XG5cdCAqIEBwYXJhbSAge09iamVjdH0gbGlzdFxuXHQgKiBAcmV0dXJuIHtBcnJheX1cblx0ICovXG5cdHZhciBjb252ZXJ0UHJldWRvQXJyYXlUb0FycmF5ID0gZXhwb3J0cy5jb252ZXJ0UHJldWRvQXJyYXlUb0FycmF5ID0gZnVuY3Rpb24gY29udmVydFByZXVkb0FycmF5VG9BcnJheShsaXN0KSB7XG5cdCAgcmV0dXJuIEFycmF5LmZyb20obGlzdCk7XG5cdH07XG5cbi8qKiovIH1cbi8qKioqKiovIF0pO1xuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzY3JpcHQuanMiLCIgXHQvLyBUaGUgbW9kdWxlIGNhY2hlXG4gXHR2YXIgaW5zdGFsbGVkTW9kdWxlcyA9IHt9O1xuXG4gXHQvLyBUaGUgcmVxdWlyZSBmdW5jdGlvblxuIFx0ZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkge1xuXG4gXHRcdC8vIENoZWNrIGlmIG1vZHVsZSBpcyBpbiBjYWNoZVxuIFx0XHRpZihpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSlcbiBcdFx0XHRyZXR1cm4gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0uZXhwb3J0cztcblxuIFx0XHQvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKVxuIFx0XHR2YXIgbW9kdWxlID0gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0gPSB7XG4gXHRcdFx0ZXhwb3J0czoge30sXG4gXHRcdFx0aWQ6IG1vZHVsZUlkLFxuIFx0XHRcdGxvYWRlZDogZmFsc2VcbiBcdFx0fTtcblxuIFx0XHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cbiBcdFx0bW9kdWxlc1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cywgbW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cbiBcdFx0Ly8gRmxhZyB0aGUgbW9kdWxlIGFzIGxvYWRlZFxuIFx0XHRtb2R1bGUubG9hZGVkID0gdHJ1ZTtcblxuIFx0XHQvLyBSZXR1cm4gdGhlIGV4cG9ydHMgb2YgdGhlIG1vZHVsZVxuIFx0XHRyZXR1cm4gbW9kdWxlLmV4cG9ydHM7XG4gXHR9XG5cblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGVzIG9iamVjdCAoX193ZWJwYWNrX21vZHVsZXNfXylcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubSA9IG1vZHVsZXM7XG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlIGNhY2hlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmMgPSBpbnN0YWxsZWRNb2R1bGVzO1xuXG4gXHQvLyBfX3dlYnBhY2tfcHVibGljX3BhdGhfX1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5wID0gXCJcIjtcblxuIFx0Ly8gTG9hZCBlbnRyeSBtb2R1bGUgYW5kIHJldHVybiBleHBvcnRzXG4gXHRyZXR1cm4gX193ZWJwYWNrX3JlcXVpcmVfXygwKTtcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyB3ZWJwYWNrL2Jvb3RzdHJhcCAzOTE2NmJmZjg1OGMxY2QzNjRkNyIsImltcG9ydCBUb2RvbGlzdCBmcm9tICcuL2pzL1RvZG9saXN0JztcbmNvbnN0IHRvZG9MaXN0ID0gbmV3IFRvZG9saXN0KGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy50b2RvbGlzdCcpKTtcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyAuL3NyYy9zY3JpcHQuanMiLCJpbXBvcnQgeyBjcmVhdGVET01FbGVtZW50LCBjb252ZXJ0UHJldWRvQXJyYXlUb0FycmF5IH0gIGZyb20gJy4vdXRpbHMnO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBUb2RvbGlzdCB7XG4gIGNvbnN0cnVjdG9yKGVsZW0pIHtcbiAgICB0aGlzLnRvZG9MaXN0ID0gZWxlbTtcbiAgICB0aGlzLnRhc2tJZCA9IDE7XG5cbiAgICB0aGlzLm9uRW50ZXJLZXlVcCA9IHRoaXMub25FbnRlcktleVVwLmJpbmQodGhpcyk7XG4gICAgdGhpcy5vbk5ld1Rhc2tOYW1lSW5wdXQgPSB0aGlzLm9uTmV3VGFza05hbWVJbnB1dC5iaW5kKHRoaXMpO1xuICAgIHRoaXMub25OZXdUYXNrQnRuQ2xpY2sgPSB0aGlzLm9uTmV3VGFza0J0bkNsaWNrLmJpbmQodGhpcyk7XG4gICAgdGhpcy5vbkNoZWNrVGFza0NsaWNrID0gdGhpcy5vbkNoZWNrVGFza0NsaWNrLmJpbmQodGhpcyk7XG4gICAgdGhpcy5vblJlbW92ZVRhc2tDbGljayA9IHRoaXMub25SZW1vdmVUYXNrQ2xpY2suYmluZCh0aGlzKTtcbiAgICB0aGlzLm9uQ2hlY2tBbGxUYXNrQ2xpY2sgPSB0aGlzLm9uQ2hlY2tBbGxUYXNrQ2xpY2suYmluZCh0aGlzKTtcbiAgICB0aGlzLm9uUmVtb3ZlQWxsVGFza0NsaWNrID0gdGhpcy5vblJlbW92ZUFsbFRhc2tDbGljay5iaW5kKHRoaXMpO1xuXG4gICAgdGhpcy5pbml0KCk7XG4gIH1cblxuICBpbml0KCkge1xuICAgIGNyZWF0ZURPTUVsZW1lbnQoJ2gxJywgdGhpcy50b2RvTGlzdCwge1xuICAgICAgY2xhc3NOYW1lOiAndG9kb2xpc3RfX3RpdGxlJyxcbiAgICAgIHRleHRDb250ZW50OiAnVG9kb0xpc3QnXG4gICAgfSk7XG5cbiAgICBjb25zdCBuZXdUYXNrID0gY3JlYXRlRE9NRWxlbWVudCgnZGl2JywgdGhpcy50b2RvTGlzdCwge1xuICAgICAgY2xhc3NOYW1lOiAndG9kb2xpc3RfX2FkZC10YXNrJ1xuICAgIH0pO1xuXG4gICAgdGhpcy5uZXdUYXNrTmFtZSA9IGNyZWF0ZURPTUVsZW1lbnQoJ2lucHV0JywgbmV3VGFzaywge1xuICAgICAgdHlwZTogJ3RleHQnLFxuICAgICAgY2xhc3NOYW1lOiAnaW5wdXQgaW5wdXQtLXRleHQgaW5wdXQtLW5ldy10YXNrJyxcbiAgICAgIHBsYWNlaG9sZGVyOiAnRW50ZXIgdGFzaydcbiAgICB9KTtcbiAgICB0aGlzLm5ld1Rhc2tOYW1lLmFkZEV2ZW50TGlzdGVuZXIoJ2lucHV0JywgdGhpcy5vbk5ld1Rhc2tOYW1lSW5wdXQpO1xuXG4gICAgdGhpcy5uZXdUYXNrQnRuID0gY3JlYXRlRE9NRWxlbWVudCgnYnV0dG9uJywgbmV3VGFzaywge1xuICAgICAgdHlwZTogJ2J1dHRvbicsXG4gICAgICBjbGFzc05hbWU6ICdidG4gYnRuLS1wcmltYXJ5IGJ0bi0tYWRkJyxcbiAgICAgIHRleHRDb250ZW50OiAnQWRkJyxcbiAgICAgIGRpc2FibGVkOiB0cnVlXG4gICAgfSk7XG4gICAgdGhpcy5uZXdUYXNrQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5vbk5ld1Rhc2tCdG5DbGljayk7XG5cbiAgICB0aGlzLnRvZG9MaXN0LmFkZEV2ZW50TGlzdGVuZXIoJ2tleXVwJywgdGhpcy5vbkVudGVyS2V5VXApO1xuICB9XG5cbiAgcmVuZGVyVGFza3NDb250YWluZXIoKSB7XG4gICAgdGhpcy50YXNrcyA9IGNyZWF0ZURPTUVsZW1lbnQoJ3VsJywgdGhpcy50b2RvTGlzdCwge1xuICAgICAgY2xhc3NOYW1lOiAndG9kb2xpc3RfX3Rhc2tzIHRhc2tzJ1xuICAgIH0pO1xuICAgIHRoaXMudGFza3MuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLm9uQ2hlY2tUYXNrQ2xpY2spO1xuICAgIHRoaXMudGFza3MuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLm9uUmVtb3ZlVGFza0NsaWNrKVxuICB9XG5cbiAgcmVuZGVyQ29udHJvbHMoKSB7XG4gICAgdGhpcy5jb250cm9scyA9IGNyZWF0ZURPTUVsZW1lbnQoJ2RpdicsIHRoaXMudG9kb0xpc3QsIHtcbiAgICAgIGNsYXNzTmFtZTogJ3RvZG9saXN0X19jb250cm9scydcbiAgICB9KTtcblxuICAgIGNvbnN0IHRpcHMgPSBjcmVhdGVET01FbGVtZW50KCdwJywgdGhpcy5jb250cm9scywge1xuICAgICAgY2xhc3NOYW1lOiAndG9kb2xpc3RfX3RpcHMnXG4gICAgfSk7XG5cbiAgICB0aGlzLmN1cnJlbnRDaGVja2VkVGFza3MgPSBjcmVhdGVET01FbGVtZW50KCdzcGFuJywgdGlwcywge1xuICAgICAgY2xhc3NOYW1lOiAnY3VycmVudC1jaGVja2VkLXRhc2tzJyxcbiAgICAgIHRleHRDb250ZW50OiAnMCdcbiAgICB9KTtcblxuICAgIGNyZWF0ZURPTUVsZW1lbnQoJ3NwYW4nLCB0aXBzLCB7XG4gICAgICB0ZXh0Q29udGVudDonIGl0ZW1zIGNoZWNrZWQnXG4gICAgfSk7XG5cbiAgICB0aGlzLmNoZWNrQWxsVGFza3NCdG4gPSBjcmVhdGVET01FbGVtZW50KCdidXR0b24nLCB0aGlzLmNvbnRyb2xzLCB7XG4gICAgICB0eXBlOiAnYnV0dG9uJyxcbiAgICAgIGNsYXNzTmFtZTogJ2J0biBidG4tLWFkZGl0aW9uYWwgYnRuLS1jaGVjaycsXG4gICAgICB0ZXh0Q29udGVudDogJ0NoZWNrIGFsbCdcbiAgICB9KTtcbiAgICB0aGlzLmNoZWNrQWxsVGFza3NCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLm9uQ2hlY2tBbGxUYXNrQ2xpY2spO1xuXG4gICAgdGhpcy5jbGVhclRhc2tMaXN0QnRuID0gY3JlYXRlRE9NRWxlbWVudCgnYnV0dG9uJywgdGhpcy5jb250cm9scywge1xuICAgICAgdHlwZTogJ2J1dHRvbicsXG4gICAgICBjbGFzc05hbWU6ICdidG4gYnRuLS1hZGRpdGlvbmFsIGJ0bi0tY2xlYXInLFxuICAgICAgdGV4dENvbnRlbnQ6ICdSZW1vdmUgYWxsJyxcbiAgICAgIGRpc2FibGVkOiB0cnVlXG4gICAgfSk7XG4gICAgdGhpcy5jbGVhclRhc2tMaXN0QnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5vblJlbW92ZUFsbFRhc2tDbGljayk7XG4gIH1cblxuICByZW5kZXJUYXNrKHRleHQpIHtcbiAgICBpZiAoIXRoaXMudGFza3MpIHtcbiAgICAgIHRoaXMucmVuZGVyVGFza3NDb250YWluZXIoKTtcbiAgICB9XG5cbiAgICBjb25zdCB0YXNrID0gY3JlYXRlRE9NRWxlbWVudCgnbGknLCB0aGlzLnRhc2tzLCB7XG4gICAgICBjbGFzc05hbWU6ICd0YXNrc19faXRlbSdcbiAgICB9KTtcblxuICAgIGNyZWF0ZURPTUVsZW1lbnQoJ2lucHV0JywgdGFzaywge1xuICAgICAgdHlwZTogJ2NoZWNrYm94JyxcbiAgICAgIGNsYXNzTmFtZTogJ2lucHV0IGlucHV0LS1jaGVja2JveCcsXG4gICAgICBuYW1lOiAndGFza0xpc3QnLFxuICAgICAgaWQ6IGBjaGVja2JveC0ke3RoaXMudGFza0lkfWAsXG4gICAgICB2YWx1ZTogYGNoZWNrYm94LSR7dGhpcy50YXNrSWR9YFxuICAgIH0pO1xuXG4gICAgY3JlYXRlRE9NRWxlbWVudCgnbGFiZWwnLCB0YXNrLCB7XG4gICAgICBodG1sRm9yOiBgY2hlY2tib3gtJHt0aGlzLnRhc2tJZH1gLFxuICAgICAgY2xhc3NOYW1lOiAnbGFiZWwgbGFiZWwtLWNoZWNrYm94JyxcbiAgICAgIHRleHRDb250ZW50OiB0ZXh0XG4gICAgfSk7XG5cbiAgICBjcmVhdGVET01FbGVtZW50KCdkaXYnLCB0YXNrLCB7XG4gICAgICBjbGFzc05hbWU6ICdpY29uIGljb24tLXJlbW92ZSdcbiAgICB9KTtcblxuICAgIHRoaXMudGFza0lkKys7XG4gIH07XG5cbiAgYWRkVGFza1RvTGlzdCgpIHtcbiAgICB0aGlzLnJlbmRlclRhc2sodGhpcy5uZXdUYXNrTmFtZS52YWx1ZSk7XG4gICAgdGhpcy5uZXdUYXNrTmFtZS52YWx1ZSA9ICcnO1xuICAgIHRoaXMubmV3VGFza0J0bi5kaXNhYmxlZCA9IHRydWU7XG5cbiAgICBpZiAoIXRoaXMuY29udHJvbHMpIHtcbiAgICAgIHRoaXMucmVuZGVyQ29udHJvbHMoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy51cGRhdGVDb250cm9sc1N0YXRlKCk7XG4gICAgfVxuICB9O1xuXG4gIHJlbW92ZVRhc2tGcm9tTGlzdChlbGVtKSB7XG4gICAgdGhpcy50YXNrcy5yZW1vdmVDaGlsZChlbGVtKTtcbiAgICBpZiAoIXRoaXMudGFza3MuZmlyc3RDaGlsZCkge1xuICAgICAgdGhpcy50b2RvTGlzdC5yZW1vdmVDaGlsZCh0aGlzLnRhc2tzKTtcbiAgICAgIHRoaXMudG9kb0xpc3QucmVtb3ZlQ2hpbGQodGhpcy5jb250cm9scyk7XG4gICAgICB0aGlzLnRhc2tzID0gbnVsbDtcbiAgICAgIHRoaXMuY29udHJvbHMgPSBudWxsO1xuICAgICAgdGhpcy5jaGVja0FsbFRhc2tzQnRuID0gbnVsbDtcbiAgICAgIHRoaXMuY2xlYXJUYXNrTGlzdEJ0biA9IG51bGw7XG4gICAgICB0aGlzLmN1cnJlbnRDaGVja2VkVGFza3MgPSBudWxsO1xuICAgIH1cbiAgfVxuXG4gIGdldCBjaGVja2VkVGFza3NDb3VudCgpIHtcbiAgICBjb25zdCB0YXNrcyA9IGNvbnZlcnRQcmV1ZG9BcnJheVRvQXJyYXkodGhpcy50YXNrcy5jaGlsZHJlbik7XG4gICAgcmV0dXJuIHRhc2tzLmZpbHRlcihpdGVtID0+IGl0ZW0ucXVlcnlTZWxlY3RvcignLmlucHV0LS1jaGVja2JveDpjaGVja2VkJykpLmxlbmd0aDtcbiAgfVxuXG4gIHVwZGF0ZUNvbnRyb2xzU3RhdGUoKSB7XG4gICAgaWYgKHRoaXMudGFza3MpIHtcbiAgICAgIGNvbnN0IGN1cnJlbnRDaGVja2VkVGFza3NDb3VudCA9IHRoaXMuY2hlY2tlZFRhc2tzQ291bnQ7XG4gICAgICB0aGlzLmN1cnJlbnRDaGVja2VkVGFza3MudGV4dENvbnRlbnQgPSBjdXJyZW50Q2hlY2tlZFRhc2tzQ291bnQ7XG4gICAgICB0aGlzLmNsZWFyVGFza0xpc3RCdG4uZGlzYWJsZWQgPSAhKGN1cnJlbnRDaGVja2VkVGFza3NDb3VudCA+IDApO1xuICAgICAgdGhpcy5jaGVja0FsbFRhc2tzQnRuLnRleHRDb250ZW50ID0gIShjdXJyZW50Q2hlY2tlZFRhc2tzQ291bnQgPT09IHRoaXMudGFza3MuY2hpbGRyZW4ubGVuZ3RoKSA/ICdDaGVjayBhbGwnIDogJ1VuY2hlY2sgYWxsJztcbiAgICB9XG4gIH1cblxuICBvbk5ld1Rhc2tOYW1lSW5wdXQoZXZlbnQpIHtcbiAgICB0aGlzLm5ld1Rhc2tCdG4uZGlzYWJsZWQgPSAhZXZlbnQuY3VycmVudFRhcmdldC52YWx1ZTtcbiAgfVxuXG4gIG9uTmV3VGFza0J0bkNsaWNrKCkge1xuICAgIHRoaXMuYWRkVGFza1RvTGlzdCgpO1xuICB9XG5cbiAgb25FbnRlcktleVVwKGV2ZW50KSB7XG4gICAgaWYgKGV2ZW50LmtleUNvZGUgPT09IDEzICYmIHRoaXMubmV3VGFza05hbWUudmFsdWUpIHtcbiAgICAgIHRoaXMuYWRkVGFza1RvTGlzdCgpO1xuICAgIH1cbiAgfTtcblxuICBvbkNoZWNrVGFza0NsaWNrKGV2ZW50KSB7XG4gICAgaWYgKGV2ZW50LnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ2lucHV0LS1jaGVja2JveCcpKSB7XG4gICAgICB0aGlzLnVwZGF0ZUNvbnRyb2xzU3RhdGUoKTtcbiAgICB9XG4gIH07XG5cbiAgb25DaGVja0FsbFRhc2tDbGljaygpIHtcbiAgICBjb25zdCB0YXNrcyA9IGNvbnZlcnRQcmV1ZG9BcnJheVRvQXJyYXkodGhpcy50YXNrcy5jaGlsZHJlbik7XG4gICAgY29uc3QgY3VycmVudENoZWNrZWRDb3VudCA9IHRoaXMuY2hlY2tlZFRhc2tzQ291bnQ7XG4gICAgdGFza3MuZm9yRWFjaChpdGVtID0+IGl0ZW0ucXVlcnlTZWxlY3RvcignLmlucHV0LS1jaGVja2JveCcpLmNoZWNrZWQgPSAhKGN1cnJlbnRDaGVja2VkQ291bnQgPT09IHRhc2tzLmxlbmd0aCkpO1xuICAgIHRoaXMudXBkYXRlQ29udHJvbHNTdGF0ZSgpO1xuICB9O1xuXG4gIG9uUmVtb3ZlVGFza0NsaWNrKGV2ZW50KSB7XG4gICAgaWYgKGV2ZW50LnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ2ljb24tLXJlbW92ZScpKSB7XG4gICAgICB0aGlzLnJlbW92ZVRhc2tGcm9tTGlzdChldmVudC50YXJnZXQucGFyZW50RWxlbWVudCk7XG4gICAgICB0aGlzLnVwZGF0ZUNvbnRyb2xzU3RhdGUoKTtcbiAgICB9XG4gIH07XG5cbiAgb25SZW1vdmVBbGxUYXNrQ2xpY2soKSB7XG4gICAgY29uc3QgdGFza3MgPSB0aGlzLnRhc2tzLmNoaWxkcmVuO1xuICAgIGZvciAobGV0IGkgPSB0YXNrcy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xuICAgICAgaWYgKHRhc2tzW2ldLnF1ZXJ5U2VsZWN0b3IoJy5pbnB1dC0tY2hlY2tib3g6Y2hlY2tlZCcpKSB7XG4gICAgICAgIHRoaXMucmVtb3ZlVGFza0Zyb21MaXN0KHRhc2tzW2ldKTtcbiAgICAgIH1cbiAgICB9XG4gICAgdGhpcy51cGRhdGVDb250cm9sc1N0YXRlKCk7XG4gIH07XG59XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gLi9zcmMvanMvVG9kb2xpc3QuanMiLCIvKipcbiAqIENyZWF0ZSBET00tZWxlbWVudFxuICogQHBhcmFtICB7U3RyaW5nfSAgdHlwZSAgICBUeXBlIG9mIGVsZW1lbnRcbiAqIEBwYXJhbSAge0VsZW1lbnR9IHBhcmVudCAgUGFyZW50IG9mIGVsZW1lbnRcbiAqIEBwYXJhbSAge09iamVjdH0gIG9wdGlvbnMgT3B0aW9ucyBvZiBlbGVtZW50XG4gKiBAcmV0dXJuIHtFbGVtZW50fVxuICovXG5leHBvcnQgY29uc3QgY3JlYXRlRE9NRWxlbWVudCA9ICh0eXBlLCBwYXJlbnQsIG9wdGlvbnMpID0+IHtcbiAgY29uc3QgZWxlbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQodHlwZSk7XG4gIGZvciAobGV0IHByb3AgaW4gb3B0aW9ucykge1xuICAgIGlmKG9wdGlvbnMuaGFzT3duUHJvcGVydHkocHJvcCkpIHtcbiAgICAgIGVsZW1bcHJvcF0gPSBvcHRpb25zW3Byb3BdO1xuICAgIH1cbiAgfVxuICBwYXJlbnQuYXBwZW5kQ2hpbGQoZWxlbSk7XG4gIHJldHVybiBlbGVtO1xufTtcblxuLyoqXG4gKiBDb252ZXJ0IHBzZXVkby1hcnJheSB0byBhcnJheVxuICogQHBhcmFtICB7T2JqZWN0fSBsaXN0XG4gKiBAcmV0dXJuIHtBcnJheX1cbiAqL1xuZXhwb3J0IGNvbnN0IGNvbnZlcnRQcmV1ZG9BcnJheVRvQXJyYXkgPSBsaXN0ID0+IEFycmF5LmZyb20obGlzdCk7XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gLi9zcmMvanMvdXRpbHMuanMiXSwic291cmNlUm9vdCI6IiJ9